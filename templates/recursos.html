<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Recursos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='recursos.css') }}">
</head>

<body>

    <h1> Recursos</h1>

    <!-- Bot√≥n de reporte general (solo para admin y directivo) -->
    {% if rol in ['admin', 'directivo'] %}
    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('reporte_general') }}" class="btn-reporte"
            style="background: #b8bdbd; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; display: inline-block; font-weight: bold;">
            Descargar Reporte General
        </a>
    </div>
    {% endif %}

    <!-- üîç BUSCAR -->
    <form method="POST" action="/recursos">
        <input type="text" name="busqueda" placeholder="Buscar...">
        <button type="submit">Buscar</button>
        <button type="button" onclick="buscarVoz()">üé§</button>
    </form>

    <h3>‚ûï Agregar recurso</h3>
    <form method="POST" action="/recursos/agregar" enctype="multipart/form-data">
        <input type="text" name="nombre" placeholder="Nombre" required>

        <!-- Materia: dropdown for teachers, text input for other roles -->
        {% if rol == 'docente' %}
        <label for="materia">Materia:</label>
        <select name="materia" id="materia" required>
            <option value="">Selecciona una materia</option>
            {% for materia in materias_docente %}
            <option value="{{ materia }}">{{ materia }}</option>
            {% endfor %}
        </select>
        {% else %}
        <input type="text" name="materia" placeholder="Materia" required>
        {% endif %}

        <!-- Tipo: dropdown with file types -->
        <label for="tipo">Tipo de archivo:</label>
        <select name="tipo" id="tipo" required>
            <option value="">Selecciona tipo de archivo</option>
            <option value="PowerPoint">PowerPoint</option>
            <option value="Excel">Excel</option>
            <option value="Word">Word</option>
            <option value="PDF">PDF</option>
            <option value="Imagen">Imagen</option>
            <option value="Video">Video</option>
            <option value="Otro">Otro</option>
        </select>

        <!-- Dropdowns para filtrado -->
        <label for="grupo">Grupo:</label>
        <select name="grupo" id="grupo">
            <option value="">Todos los grupos</option>
            <option value="501">501</option>
            <option value="502">502</option>
            <option value="503">503</option>
            <option value="504">504</option>
            <option value="505">505</option>
            <option value="301">301</option>
            <option value="302">302</option>
            <option value="303">303</option>
            <option value="304">304</option>
            <option value="305">305</option>
        </select>

        <label for="semestre">Semestre:</label>
        <select name="semestre" id="semestre">
            <option value="">Todos los semestres</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
        </select>

        <label for="turno">Turno:</label>
        <select name="turno" id="turno">
            <option value="">Todos los turnos</option>
            <option value="Matutino">Matutino</option>
            <option value="Vespertino">Vespertino</option>
        </select>

        <label for="archivo">Archivo del recurso:</label>
        <input type="file" name="archivo" required>
        <button type="submit">Agregar</button>
    </form>

    <table>
        <tr>
            <th>ID</th>
            <th>Fecha</th>
            <th>Nombre</th>
            <th>Materia</th>
            <th>Tipo</th>
            <th>Acciones</th>
        </tr>

        {% for r in recursos %}
        <tr>
            <td>{{ r.id }}</td>
            <td>{{ r.fecha }}</td>
            <td>{{ r.nombre }}</td>
            <td>{{ r.materia }}</td>
            <td>{{ r.tipo }}</td>
            <td>
                <a href="/recursos/descargar/{{ r.id }}" style="color: #3498db;">üì• Descargar</a>
                <a href="/recursos/editar/{{ r.id }}">‚úè Editar</a>
                <a href="/recursos/eliminar/{{ r.id }}" onclick="return confirm('¬øEst√°s seguro?')">üóë Eliminar</a>
                <a href="/docente/visualizaciones/{{ r.id }}" style="color: #3498db;">üìä Ver Usuarios</a>
            </td>
        </tr>
        {% endfor %}
    </table>

    <div style="margin-top: 30px;">
        <a href="{{ url_for('recursos') }}">‚ÜêVolver al men√∫</a>
    </div>

    <script>
        function buscarVoz() {
            if (!('webkitSpeechRecognition' in window)) {
                alert("Tu navegador no soporta reconocimiento de voz");
                return;
            }

            let reconocimiento = new webkitSpeechRecognition();
            reconocimiento.lang = "es-MX";
            reconocimiento.continuous = false;
            reconocimiento.interimResults = false;

            reconocimiento.start();

            reconocimiento.onresult = function (event) {
                const texto = event.results[0][0].transcript;
                document.querySelector("input[name='busqueda']").value = texto;
                document.querySelector("form").submit();
            };
        }
    </script>

</body>

</html>